import { NextRequest, NextResponse } from 'next/server'
import { redis } from '@/lib/redis'
import { getCampaign } from '@/lib/campaign'

export async function POST(request: NextRequest) {
  const campaignId = 'campaign:Te-1hZJ5AfwCwAEayvwLI'
  
  try {
    console.log('Starting full recovery for:', campaignId)
    
    // Get the campaign
    const campaign = await getCampaign(campaignId)
    if (!campaign) {
      return NextResponse.json({ error: 'Campaign not found' }, { status: 404 })
    }
    
    // The KOL data we found earlier
    const recoveredKol = {
      profileImage: "data:image/jpeg;base64,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",
      id: "etdxqoWzeDR5jzWzWHnGT",
      contact: "",
      views: 0,
      platform: ["x"],
      budget: "$70",
      productId: "prod_OM7aZQtOK7Zk59-FoSICN",
      links: [],
      name: "hasaniiiii",
      productCost: 70,
      lastUpdated: "2025-06-11T02:14:03.636Z",
      tier: "micro" as const,
      device: "owned" as const,
      stage: "reached out" as const,
      handle: "hasannnn",
      payment: "pending" as const
    }
    
    // Update campaign with the recovered KOL
    campaign.kols = [recoveredKol]
    campaign.updatedAt = new Date().toISOString()
    
    // Save the updated campaign
    await redis.json.set(campaignId, '$', campaign)
    
    console.log('Recovery completed successfully')
    
    return NextResponse.json({
      success: true,
      message: 'Successfully recovered 1 KOL',
      campaign: campaign.name,
      recoveredKols: [recoveredKol]
    })
  } catch (error) {
    console.error('Error in full recovery:', error)
    return NextResponse.json(
      { 
        error: 'Failed to recover KOLs', 
        details: error instanceof Error ? error.message : 'Unknown error' 
      }, 
      { status: 500 }
    )
  }
} 